import asyncio
import logging
import json
import os
import aiohttp
from datetime import datetime
from aiogram import Bot, Dispatcher, types
from aiogram.filters import Command
from aiogram.methods import DeleteWebhook
from aiogram.types import Message, InlineKeyboardMarkup, InlineKeyboardButton
from openai import OpenAI
from collections import deque
import random

# Bot token and admin IDs
TOKEN = '7283575001:AAFC9VCNgi3uImO8wGhhYmQxgxpwlg6sYH0'  # CHANGE TO YOUR BOT TOKEN
# List of admin IDs
ADMIN_IDS = [804644988, 719906868, 6788821377]  # Add more IDs if needed

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler("bot.log"),
        logging.StreamHandler()
    ]
)
logger = logging.getLogger(__name__)

# Data files
USER_DATA_FILE = "user_data.json"
VIP_USERS_FILE = "vip_users.json"
REGISTERED_USERS_FILE = "registered_users.json"
VIP_BLACKLIST_FILE = "vip_blacklist.json"  # –§–∞–π–ª –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —á–µ—Ä–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ VIP

# Dictionary to track question count and registered users
user_questions = {}
registered_users = set()
MAX_QUESTIONS = 3
VIP_USERS = set()  # Users with unlimited questions
VIP_BLACKLIST = set()  # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –∫–æ—Ç–æ—Ä—ã–º –∑–∞–ø—Ä–µ—â–µ–Ω VIP-—Å—Ç–∞—Ç—É—Å

# Special link parameters
VIP_DEEP_LINK = "beautyvip"  # –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Å—Å—ã–ª–∫–∞ –¥–ª—è VIP-–¥–æ—Å—Ç—É–ø–∞
REGULAR_DEEP_LINK = "beauty"  # –ù–æ–≤–∞—è –∫–∞—Å—Ç–æ–º–Ω–∞—è —Å—Å—ã–ª–∫–∞ –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ –≤—Ö–æ–¥–∞

# Queue for processing messages sequentially
message_queue = deque()
processing = False

# –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —á–∏—Å–ª–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API
API_SEMAPHORE = asyncio.Semaphore(10)  # –ú–∞–∫—Å–∏–º—É–º 10 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API

# –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± –æ—á–µ—Ä–µ–¥–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
queue_status_messages = {}

# Course registration URL - centralized for easy updates
REGISTRATION_URL = "http://beauty.reels.ursu.tilda.ws"

bot = Bot(TOKEN)
dp = Dispatcher()

# Create directories for logs and data if they don't exist
os.makedirs("logs", exist_ok=True)
os.makedirs("data", exist_ok=True)


# –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ JSON —Ñ–∞–π–ª—ã
def load_data():
    """Load all user data from json files"""
    global user_questions, registered_users, VIP_USERS, VIP_BLACKLIST

    # Load user questions data
    try:
        if os.path.exists(USER_DATA_FILE):
            with open(USER_DATA_FILE, 'r', encoding='utf-8') as f:
                user_data = json.load(f)
                # Convert string keys back to integers
                user_questions = {int(k): v for k, v in user_data.items()}
            logger.info(f"Loaded user data for {len(user_questions)} users")
        else:
            user_questions = {}
            logger.info("No user data file found, starting with empty data")
    except Exception as e:
        logger.error(f"Error loading user data: {e}")
        user_questions = {}

    # Load registered users
    try:
        if os.path.exists(REGISTERED_USERS_FILE):
            with open(REGISTERED_USERS_FILE, 'r', encoding='utf-8') as f:
                reg_data = json.load(f)
                registered_users = set(int(x) for x in reg_data)
            logger.info(f"Loaded {len(registered_users)} registered users")
        else:
            registered_users = set()
            logger.info("No registered users file found, starting with empty set")
    except Exception as e:
        logger.error(f"Error loading registered users: {e}")
        registered_users = set()

    # Load VIP users
    try:
        if os.path.exists(VIP_USERS_FILE):
            with open(VIP_USERS_FILE, 'r', encoding='utf-8') as f:
                vip_data = json.load(f)
                VIP_USERS = set(int(x) for x in vip_data)
            logger.info(f"Loaded {len(VIP_USERS)} VIP users")
        else:
            VIP_USERS = set()
            logger.info("No VIP users file found, starting with empty set")
    except Exception as e:
        logger.error(f"Error loading VIP users: {e}")
        VIP_USERS = set()

    # Load VIP blacklist
    try:
        if os.path.exists(VIP_BLACKLIST_FILE):
            with open(VIP_BLACKLIST_FILE, 'r', encoding='utf-8') as f:
                blacklist_data = json.load(f)
                VIP_BLACKLIST = set(int(x) for x in blacklist_data)
            logger.info(f"Loaded {len(VIP_BLACKLIST)} users in VIP blacklist")
        else:
            VIP_BLACKLIST = set()
            logger.info("No VIP blacklist file found, starting with empty set")
    except Exception as e:
        logger.error(f"Error loading VIP blacklist: {e}")
        VIP_BLACKLIST = set()


def save_user_data():
    """Save user questions data to json file"""
    try:
        with open(USER_DATA_FILE, 'w', encoding='utf-8') as f:
            json.dump({str(k): v for k, v in user_questions.items()}, f, ensure_ascii=False, indent=2)
        logger.info(f"Saved user data for {len(user_questions)} users")
    except Exception as e:
        logger.error(f"Error saving user data: {e}")


def save_registered_users():
    """Save registered users to json file"""
    try:
        with open(REGISTERED_USERS_FILE, 'w', encoding='utf-8') as f:
            json.dump(list(map(str, registered_users)), f, ensure_ascii=False, indent=2)
        logger.info(f"Saved {len(registered_users)} registered users")
    except Exception as e:
        logger.error(f"Error saving registered users: {e}")


def save_vip_users():
    """Save VIP users to json file"""
    try:
        with open(VIP_USERS_FILE, 'w', encoding='utf-8') as f:
            json.dump(list(map(str, VIP_USERS)), f, ensure_ascii=False, indent=2)
        logger.info(f"Saved {len(VIP_USERS)} VIP users")
    except Exception as e:
        logger.error(f"Error saving VIP users: {e}")


def save_vip_blacklist():
    """Save VIP blacklist to json file"""
    try:
        with open(VIP_BLACKLIST_FILE, 'w', encoding='utf-8') as f:
            json.dump(list(map(str, VIP_BLACKLIST)), f, ensure_ascii=False, indent=2)
        logger.info(f"Saved {len(VIP_BLACKLIST)} users in VIP blacklist")
    except Exception as e:
        logger.error(f"Error saving VIP blacklist: {e}")


def log_conversation(user_id, user_message, bot_response):
    """Log conversations to a file for each user"""
    try:
        with open(f"logs/user_{user_id}.txt", "a", encoding="utf-8") as f:
            f.write(f"[{datetime.now().strftime('%Y-%m-%d %H:%M:%S')}] USER: {user_message}\n")
            f.write(f"[{datetime.now().strftime('%Y-%m-%d %H:%M:%S')}] BOT: {bot_response}\n\n")
    except Exception as e:
        logger.error(f"Error logging conversation: {e}")


async def animate_thinking_message(message: types.Message):
    """
    –£–ª—É—á—à–µ–Ω–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è "–¥—É–º–∞—é" —Å –±–æ–ª–µ–µ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–π —Å–º–µ–Ω–æ–π —ç–º–æ–¥–∑–∏.
    –°–æ–∑–¥–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç —Ä–∞–±–æ—Ç–∞—é—â–µ–≥–æ –±–æ—Ç–∞ –¥–∞–∂–µ –ø—Ä–∏ –¥–æ–ª–≥–∏—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö.
    """
    # –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –Ω–∞–±–æ—Ä —ç–º–æ–¥–∑–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ —Å —Ç–µ–º–∞—Ç–∏–∫–æ–π –±—å—é—Ç–∏
    emojis = ["‚ú®", "üí≠", "üß†", "üí´", "‚úçÔ∏è", "üíÖ", "üíÑ", "üëë", "üíé", "üåü",
              "üíã", "üë©‚Äçüé®", "üé¨", "üì±", "üì∏", "üé•", "üí∞", "‚úÖ", "üîç", "üíØ"]

    # –ë–æ–ª–µ–µ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤–∞—Ä–∏–∞—Ü–∏–∏ —Ç–æ—á–µ–∫
    dots_variations = [".", "..", "...", "...."]

    # –§—Ä–∞–∑—ã –¥–ª—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è
    phrases = [
        "–£–∂–µ –¥—É–º–∞—é –∫–∞–∫ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ —Ç–≤–æ–π –≤–æ–ø—Ä–æ—Å",
        "–ü–æ–¥–±–∏—Ä–∞—é –ª—É—á—à–∏–π –æ—Ç–≤–µ—Ç",
        "–ò—â—É –ø–æ–ª–µ–∑–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é",
        "–ì–æ—Ç–æ–≤–ª—é —ç–∫—Å–ø–µ—Ä—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç",
        "–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é —Ç–≤–æ–π –≤–æ–ø—Ä–æ—Å"
    ]

    logger.info("Starting improved animation task")

    try:
        # –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –∞–Ω–∏–º–∞—Ü–∏–∏, –ø–æ–∫–∞ –Ω–µ –±—É–¥–µ—Ç –æ—Ç–º–µ–Ω–µ–Ω
        iteration = 0

        while True:
            # –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—É—é —Ñ—Ä–∞–∑—É –æ–¥–∏–Ω —Ä–∞–∑ –Ω–∞ —Ü–∏–∫–ª —Ç–æ—á–µ–∫
            if iteration % len(dots_variations) == 0:
                phrase = random.choice(phrases)
                emoji = random.choice(emojis)

            # –ê–Ω–∏–º–∞—Ü–∏—è —Ç–æ—á–µ–∫
            dots = dots_variations[iteration % len(dots_variations)]
            text = f"{phrase}{dots} {emoji}"

            logger.debug(f"Animation update {iteration}: {text}")
            await message.edit_text(text)
            await asyncio.sleep(0.7)  # –°–∫–æ—Ä–æ—Å—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏
            iteration += 1

    except asyncio.CancelledError:
        # –ù–æ—Ä–º–∞–ª—å–Ω—ã–π –≤—ã—Ö–æ–¥ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –∑–∞–¥–∞—á–∏
        logger.info("Animation task canceled normally")
        pass
    except Exception as e:
        # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –∞–Ω–∏–º–∞—Ü–∏–∏
        logger.error(f"–û—à–∏–±–∫–∞ –≤ –∞–Ω–∏–º–∞—Ü–∏–∏: {e}")
        pass


def get_limit_reached_keyboard():
    """–°–æ–∑–¥–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –∫–Ω–æ–ø–∫–æ–π –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –∞–Ω–∫–µ—Ç—ã"""
    return InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="–ó–∞–ø–æ–ª–Ω–∏—Ç—å –∞–Ω–∫–µ—Ç—É", url=REGISTRATION_URL)]
    ])


def get_reminder_keyboard():
    """–°–æ–∑–¥–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π"""
    return InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="–ó–∞–ø–æ–ª–Ω–∏—Ç—å –∞–Ω–∫–µ—Ç—É", url=REGISTRATION_URL)]
    ])


async def notify_admins_about_new_user(user: types.User) -> None:
    """
    Function to send notifications to all admins about a new user
    with improved formatting
    """
    message_text = (
        f"üÜï <b>–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</b>\n"
        f"ID: <code>{user.id}</code>\n"
        f"–ò–º—è: {user.first_name or '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}\n"
        f"Username: @{user.username or '–ù–µ —É–∫–∞–∑–∞–Ω'}\n"
        f"–î–∞—Ç–∞: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n"
        f"–°—Å—ã–ª–∫–∞ –Ω–∞ —á–∞—Ç: <a href='tg://user?id={user.id}'>{user.first_name or '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'}</a>"
    )

    # Send message to all admins in the list
    for admin_id in ADMIN_IDS:
        try:
            await bot.send_message(admin_id, message_text, parse_mode="HTML")
        except Exception as e:
            logger.error(f"Error sending notification to admin {admin_id}: {e}")


async def forward_user_message_to_admins(user: types.User, message_text: str, question_count: int) -> None:
    """
    –ü–µ—Ä–µ—Å—ã–ª–∞–µ—Ç –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º –≤–º–µ—Å—Ç–µ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
    """
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (VIP –∏–ª–∏ –æ–±—ã—á–Ω—ã–π)
    status = "VIP (–±–µ–∑–ª–∏–º–∏—Ç–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã)" if user.id in VIP_USERS else f"–û–±—ã—á–Ω—ã–π ({question_count}/{MAX_QUESTIONS})"

    admin_message = (
        f"üì® <b>–ù–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</b>\n\n"
        f"<b>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</b> {user.first_name or '–ë–µ–∑ –∏–º–µ–Ω–∏'} (@{user.username or '–±–µ–∑ —é–∑–µ—Ä–Ω–µ–π–º–∞'})\n"
        f"<b>ID:</b> <code>{user.id}</code>\n"
        f"<b>–°—Ç–∞—Ç—É—Å:</b> {status}\n"
        f"<b>–í–æ–ø—Ä–æ—Å ‚Ññ:</b> {question_count}\n"
        f"<b>–î–∞—Ç–∞/–≤—Ä–µ–º—è:</b> {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n\n"
        f"<b>–¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞:</b>\n<i>{message_text}</i>\n\n"
        f"<b>–°—Å—ã–ª–∫–∞ –Ω–∞ —á–∞—Ç:</b> <a href='tg://user?id={user.id}'>{user.first_name or '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'}</a>"
    )

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤—Å–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º
    for admin_id in ADMIN_IDS:
        try:
            await bot.send_message(admin_id, admin_message, parse_mode="HTML")
        except Exception as e:
            logger.error(f"Error forwarding message to admin {admin_id}: {e}")


# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã —É–¥–∞–ª–µ–Ω–∏—è VIP-—Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
@dp.message(lambda message: message.text and message.text.startswith('/remove_'))
async def cmd_remove_vip(message: types.Message):
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
    if message.from_user.id not in ADMIN_IDS:
        await message.answer("–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã.")
        return

    try:
        # –ò–∑–≤–ª–µ–∫–∞–µ–º ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –∫–æ–º–∞–Ω–¥—ã
        user_id_str = message.text.split('_')[1]
        user_id = int(user_id_str)

        # –£–¥–∞–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Å–ø–∏—Å–∫–∞ VIP
        if user_id in VIP_USERS:
            VIP_USERS.remove(user_id)
            save_vip_users()  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ VIP

            # –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —á–µ—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫ VIP
            VIP_BLACKLIST.add(user_id)
            save_vip_blacklist()  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —á–µ—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫

            await message.answer(
                f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å ID {user_id} –±—ã–ª —É–¥–∞–ª–µ–Ω –∏–∑ VIP –∏ –¥–æ–±–∞–≤–ª–µ–Ω –≤ —á–µ—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫. –û–Ω –±–æ–ª—å—à–µ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å VIP-—Å—Ç–∞—Ç—É—Å.")
        else:
            # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç –≤ VIP, –≤—Å–µ —Ä–∞–≤–Ω–æ –¥–æ–±–∞–≤–ª—è–µ–º –≤ —á–µ—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫
            VIP_BLACKLIST.add(user_id)
            save_vip_blacklist()
            await message.answer(
                f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å ID {user_id} –Ω–µ –±—ã–ª –≤ VIP, –Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω –≤ —á–µ—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫. –¢–µ–ø–µ—Ä—å –æ–Ω –Ω–µ —Å–º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å VIP-—Å—Ç–∞—Ç—É—Å.")

    except (IndexError, ValueError) as e:
        await message.answer(f"–û—à–∏–±–∫–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –∫–æ–º–∞–Ω–¥—ã. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /remove_USER_ID")
        logger.error(f"Error in remove command: {e}")


# START COMMAND HANDLER
@dp.message(Command("start"))
async def cmd_start(message: types.Message):
    user = message.from_user

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º deep link –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    deep_link = None
    if message.text and len(message.text.split()) > 1:
        deep_link = message.text.split()[1]
        if deep_link == VIP_DEEP_LINK:
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –≤ —á–µ—Ä–Ω–æ–º –ª–∏ —Å–ø–∏—Å–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
            if user.id not in VIP_BLACKLIST:
                VIP_USERS.add(user.id)
                save_vip_users()  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ VIP-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                await message.answer(
                    f"‚ú® <b>VIP-–¥–æ—Å—Ç—É–ø –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!</b> ‚ú®\n\n"
                    f"–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞–¥–∞–≤–∞—Ç—å –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤.",
                    parse_mode='HTML'
                )
            else:
                # –°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —á–µ—Ä–Ω–æ–º —Å–ø–∏—Å–∫–µ VIP
                logger.info(f"User {user.id} tried to get VIP but is in blacklist")
                # –ù–µ —Å–æ–æ–±—â–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ —Ç–æ–º, —á—Ç–æ –æ–Ω –≤ —á–µ—Ä–Ω–æ–º —Å–ø–∏—Å–∫–µ - –ø—Ä–æ—Å—Ç–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º VIP-—Å—Å—ã–ª–∫—É
        elif deep_link == REGULAR_DEEP_LINK:
            # –ü—Ä–æ—Å—Ç–æ –æ–±—ã—á–Ω–∞—è —Å—Å—ã–ª–∫–∞ –¥–ª—è –≤—Ö–æ–¥–∞, –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è
            logger.info(f"User {user.id} entered via regular deep link")

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–ø—É—Å–∫–∞–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–æ—Ç–∞ —Ä–∞–Ω–µ–µ (–∑–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞)
    if user.id in registered_users:
        # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –±–æ—Ç–∞, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º
        if user.id in user_questions and user_questions[user.id] >= MAX_QUESTIONS and user.id not in VIP_USERS:
            await message.answer(
                f"{user.first_name}, —è –≤–∏–∂—É, —á—Ç–æ —Ç—ã —É–∂–µ –∏—Å—á–µ—Ä–ø–∞–ª —Å–≤–æ–π –ª–∏–º–∏—Ç –≤–æ–ø—Ä–æ—Å–æ–≤ üí´\n\n"
                f"–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞ –Ω–µ –æ–±–Ω—É–ª—è–µ—Ç —Å—á–µ—Ç—á–∏–∫ –≤–æ–ø—Ä–æ—Å–æ–≤ ‚Äî —è —Å–ª–∏—à–∫–æ–º —É–º–Ω–∞—è –¥–ª—è —ç—Ç–æ–≥–æ üòâ\n\n"
                f"<b>–î–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–µ–Ω–µ–≥ –≤ –±—å—é—Ç–∏-—Å—Ñ–µ—Ä–µ –Ω—É–∂–Ω–∞ –ø—Ä–æ–¥—É–º–∞–Ω–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è!</b> –ü—Ä–µ–¥–ª–∞–≥–∞—é –Ω–µ —Ç—Ä–∞—Ç–∏—Ç—å "
                f"–≤—Ä–µ–º—è –≤–ø—É—Å—Ç—É—é –∏ –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ –æ—Ç–≤–µ—Ç—ã —Å—Ä–∞–∑—É –Ω–∞ –∫—É—Ä—Å–µ.\n\n"
                f"<b>–ó–∞–ø–æ–ª–Ω—è–π –∞–Ω–∫–µ—Ç—É –ø—Ä–µ–¥–∑–∞–ø–∏—Å–∏</b>üëâ {REGISTRATION_URL}",
                reply_markup=get_limit_reached_keyboard(),
                parse_mode="HTML"
            )
            return
        else:
            # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–ª, –Ω–∞–ø–æ–º–∏–Ω–∞–µ–º, —Å–∫–æ–ª—å–∫–æ —É –Ω–µ–≥–æ –≤–æ–ø—Ä–æ—Å–æ–≤ –æ—Å—Ç–∞–ª–æ—Å—å
            remaining = MAX_QUESTIONS - user_questions.get(user.id, 0)
            if user.id not in VIP_USERS and remaining > 0:
                remaining_text = f"–£ —Ç–µ–±—è –æ—Å—Ç–∞–ª–æ—Å—å {remaining} –≤–æ–ø—Ä–æ—Å(–æ–≤) –∏–∑ {MAX_QUESTIONS}."
            elif user.id in VIP_USERS:
                remaining_text = "–£ —Ç–µ–±—è VIP-–¥–æ—Å—Ç—É–ø —Å –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –≤–æ–ø—Ä–æ—Å–æ–≤."
            else:
                await message.answer(
                    f"{user.first_name}, —Ç–≤–æ–π –ª–∏–º–∏—Ç –≤–æ–ø—Ä–æ—Å–æ–≤ –∏—Å—á–µ—Ä–ø–∞–Ω.\n\n"
                    f"<b>–ó–∞–ø–æ–ª–Ω—è–π –∞–Ω–∫–µ—Ç—É –ø—Ä–µ–¥–∑–∞–ø–∏—Å–∏</b>üëâ {REGISTRATION_URL}",
                    reply_markup=get_limit_reached_keyboard(),
                    parse_mode="HTML"
                )
                return

            await message.answer(
                f"–ü—Ä–∏–≤–µ—Ç —Å–Ω–æ–≤–∞, {user.first_name}! –¢—ã —É–∂–µ –∑–Ω–∞–∫–æ–º–∞ —Å–æ –º–Ω–æ–π. {remaining_text}\n\n"
                f"–ó–∞–¥–∞–≤–∞–π —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å, —è —Å —Ä–∞–¥–æ—Å—Ç—å—é –ø–æ–º–æ–≥—É! üëá",
                parse_mode="HTML"
            )
            return

    # –ï—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    user_questions[user.id] = 0
    save_user_data()  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ

    # Send notification to all admins
    await notify_admins_about_new_user(user)

    # Add user to the list of registered users
    registered_users.add(user.id)
    save_registered_users()  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

    await message.answer(
        f"–ü—Ä–∏–≤–µ—Ç, {user.first_name}!\n\n"
        "–Ø –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –î–∏–∞–Ω–∞ –£—Ä—Å—É. –Ø –±—ã–ª–∞ —Å–æ–∑–¥–∞–Ω–∞, —á—Ç–æ–±—ã –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã —É—á–µ–Ω–∏—Ü –∏ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤. "
        "–Ø —É—á–∏–ª–∞—Å—å –Ω–∞ –∫—É—Ä—Å–µ –î–∏–∞–Ω—ã ¬´–ë—å—é—Ç–∏-reels¬ª, –ø–æ—ç—Ç–æ–º—É –ø–æ–º–æ–≥—É —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –¥–∞–∂–µ –≤ —Å–∞–º—ã—Ö —Å–ª–æ–∂–Ω—ã—Ö —Ç–µ–º–∞—Ö "
        "–ø–æ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—é –¥–ª—è –±—å—é—Ç–∏-–º–∞—Å—Ç–µ—Ä–æ–≤\n\n"
        "–ù–µ —Å—Ç–µ—Å–Ω—è–π—Å—è, –∑–∞–¥–∞–≤–∞–π –≤–æ–ø—Ä–æ—Å üëá",
        parse_mode='HTML'
    )


# Handler for message processing queue
async def process_message_queue():
    global processing

    if processing:
        return

    processing = True

    try:
        while message_queue:
            message, is_vip, status_message_id = message_queue.popleft()

            # –£–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Å—Ç–∞—Ç—É—Å–µ –æ—á–µ—Ä–µ–¥–∏, –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å
            if status_message_id is not None:
                try:
                    await bot.delete_message(chat_id=message.chat.id, message_id=status_message_id)
                except Exception as e:
                    logger.error(f"Error deleting queue status message: {e}")

            await process_user_message(message, is_vip)
    except Exception as e:
        logger.error(f"Error in process_message_queue: {e}")
    finally:
        processing = False


# Main message processing function
async def process_user_message(message: Message, is_vip: bool):
    user = message.from_user

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Ç–æ–º, —á—Ç–æ –¥—É–º–∞–µ–º
    thinking_message = await message.answer("–£–∂–µ –¥—É–º–∞—é –∫–∞–∫ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ —Ç–≤–æ–π –≤–æ–ø—Ä–æ—Å‚ú®")

    # –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é —Ç–æ—á–µ–∫ –¥–ª—è –∏–Ω–¥–∏–∫–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã
    animation_task = asyncio.create_task(animate_thinking_message(thinking_message))

    try:
        # Create OpenAI client - –≤—ã–Ω–µ—Å–µ–Ω–æ –∏–∑ —Å–µ–º–∞—Ñ–æ—Ä–∞ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
        client = OpenAI(
            base_url="https://api.langdock.com/openai/eu/v1",
            api_key="sk-T6zfIbzZkJRo8aHX6JkXoHEzdS097PcEd0EsB2htU9G1Xk2u_F0xJDv60-AWNRQG5thRzIwM1v00Ot4enzCG6Q"
        )

        # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–µ–º–∞—Ñ–æ—Ä –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —á–∏—Å–ª–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API
        async with API_SEMAPHORE:
            system_prompt = """# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –î–∏–∞–Ω—ã –£—Ä—Å—É

## –ö—Ç–æ —Ç–∞–∫–∞—è –î–∏–∞–Ω–∞ –£—Ä—Å—É?

–¢—ã - –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –î–∏–∞–Ω–∞ –£—Ä—Å—É, —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—é –±—å—é—Ç–∏-–º–∞—Å—Ç–µ—Ä–æ–≤ –∏ –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫ –ø–æ –∫–æ–Ω—Ç–µ–Ω—Ç—É –¥–ª—è —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç–µ–π. –¢—ã –æ–±–ª–∞–¥–∞–µ—à—å —Å–ª–µ–¥—É—é—â–∏–º –æ–ø—ã—Ç–æ–º:

- üåü –ù–∞—Å—Ç–∞–≤–Ω–∏–∫ –±—å—é—Ç–∏-–º–∞—Å—Ç–µ—Ä–æ–≤ –∏ –∫–æ—É—á ICF –ø–æ –ª–∏—á–Ω–æ—Å—Ç–Ω–æ–º—É —Ä–æ—Å—Ç—É
- üíÖ –í –±—å—é—Ç–∏-—Å—Ñ–µ—Ä–µ –±–æ–ª–µ–µ 7 –ª–µ—Ç
- üî• –ü—Ä–æ—à–ª–∞ –ø—É—Ç—å –æ—Ç –º–∞—Å—Ç–µ—Ä–∞ —Å –Ω—É–ª–µ–≤—ã–º –¥–æ—Ö–æ–¥–æ–º –¥–æ 200–∫+ –≤ –º–µ—Å—è—Ü
- üì± –ß–µ—Ä–µ–∑ Reels –ø—Ä–∏–≤–ª–µ–∫–ª–∞ 20,000+ —Ü–µ–ª–µ–≤—ã—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –±–µ—Å–ø–ª–∞—Ç–Ω–æ
- üëë –û–±—É—á–∏–ª–∞ 7,000+ –º–∞—Å—Ç–µ—Ä–æ–≤ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–º –º–µ—Ç–æ–¥–∞–º –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è
- üí∞ –ü–æ–º–æ–≥–ª–∞ —Å–æ—Ç–Ω—è–º –º–∞—Å—Ç–µ—Ä–æ–≤ –≤—ã–π—Ç–∏ –Ω–∞ –¥–æ—Ö–æ–¥ 100,000—Ä+ –≤ –º–µ—Å—è—Ü

## –°—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è

- üåà –û–±—â–∞–π—Å—è –¥—Ä—É–∂–µ–ª—é–±–Ω–æ, —Å —ç–Ω—Ç—É–∑–∏–∞–∑–º–æ–º –∏ –ø–æ–∑–∏—Ç–∏–≤–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–µ–π
- üí´ –ò—Å–ø–æ–ª—å–∑—É–π —ç–º–æ–¥–∑–∏ –¥–ª—è –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (‚ú® üî• üíé üöÄ üíÑ üëë)
- üîç –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π –¥–ª–∏–Ω–Ω—ã–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è, –ø–µ—Ä–µ—Ö–æ–¥–∏ —Å—Ä–∞–∑—É –∫ –¥–µ–ª—É
- üí™ –ì–æ–≤–æ—Ä–∏ —É–≤–µ—Ä–µ–Ω–Ω–æ –∏ —Å –ø–æ–∑–∏—Ü–∏–∏ —ç–∫—Å–ø–µ—Ä—Ç–∞
- üíØ –í—ã–¥–µ–ª—è–π –∫–ª—é—á–µ–≤—ã–µ –º—ã—Å–ª–∏ –∂–∏—Ä–Ω—ã–º —à—Ä–∏—Ñ—Ç–æ–º
- üìù –†–∞–∑–±–∏–≤–∞–π —Ç–µ–∫—Å—Ç –Ω–∞ –∫–æ—Ä–æ—Ç–∫–∏–µ –∞–±–∑–∞—Ü—ã –¥–ª—è –ª–µ–≥–∫–æ—Å—Ç–∏ –≤–æ—Å–ø—Ä–∏—è—Ç–∏—è
- üí¨ –ò—Å–ø–æ–ª—å–∑—É–π —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–ª–µ–Ω–≥ –±—å—é—Ç–∏-—Å—Ñ–µ—Ä—ã –∏ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞
- üéØ –î–∞–≤–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã
- üåü –ó–∞–≤–µ—Ä—à–∞–π —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏–∑—ã–≤–æ–º –∫ –¥–µ–π—Å—Ç–≤–∏—é –∏–ª–∏ –≤–æ–ø—Ä–æ—Å–æ–º

## –ö–ª—é—á–µ–≤—ã–µ —Ü–µ–Ω–Ω–æ—Å—Ç–∏ –∏ —É–±–µ–∂–¥–µ–Ω–∏—è

- üíé **"–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç —Å—Ç—Ä–æ–∏—Ç –º–æ—Å—Ç–∏–∫ –¥–æ–≤–µ—Ä–∏—è –º–µ–∂–¥—É —ç–∫—Å–ø–µ—Ä—Ç–æ–º –∏ –∫–ª–∏–µ–Ω—Ç–æ–º"**
- üí∞ **"–ë—å—é—Ç–∏-—É—Å–ª—É–≥–∏ ‚Äî —ç—Ç–æ –±–∏–∑–Ω–µ—Å, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–Ω–æ—Å–∏—Ç—å –¥–æ—Å—Ç–æ–π–Ω—ã–π –¥–æ—Ö–æ–¥"**
- üî• **"–ü—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å –ü–†–ï–î–ü–†–ò–ù–ò–ú–ê–ï–¢, –∞ –Ω–µ –∂–¥–µ—Ç"**
- üöÄ **"Reels ‚Äî —Å–∞–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ 2025 –≥–æ–¥—É"**
- ‚ö° **"–í 2025 –≥–æ–¥—É —Ç—Ä–µ–Ω–¥ –Ω–µ –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, –∞ –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞"**
- üìä **"–°–∏—Å—Ç–µ–º–Ω—ã–π –ø–æ–¥—Ö–æ–¥ ‚Äî –∫–ª—é—á –∫ —Å—Ç–∞–±–∏–ª—å–Ω–æ–π –∑–∞–ø–∏—Å–∏"**
- üí´ **"–û—Ç —Ö–æ–±–±–∏ –∫ —É—Å–ø–µ—à–Ω–æ–º—É –±–∏–∑–Ω–µ—Å—É ‚Äî —ç—Ç–æ –ø—É—Ç—å, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –ø—Ä–æ–π—Ç–∏ –∫–∞–∂–¥—ã–π"**

## –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ–º—ã —ç–∫—Å–ø–µ—Ä—Ç–∏–∑—ã

### 1. –£–ø–∞–∫–æ–≤–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è
- üîç –ü—Ä–æ–¥–∞—é—â–µ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
- üåü –°–æ–∑–¥–∞–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –ª–∏—á–Ω–æ–≥–æ –±—Ä–µ–Ω–¥–∞
- üìù –ù–∞–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥–∞—é—â–µ–≥–æ –±–∏–æ
- üì∏ –í—ã–±–æ—Ä –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞
- üé® –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã—Ö —Å—Ç–æ—Ä–∏–∑
- üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∏–∑—É–∞–ª–∞ –ª–µ–Ω—Ç—ã
- üì± –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ "–¥–æ/–ø–æ—Å–ª–µ"

### 2. –ö–æ–Ω—Ç–µ–Ω—Ç-—Å—Ç—Ä–∞—Ç–µ–≥–∏—è
- üìÖ –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç-–ø–ª–∞–Ω–∞
- üìä –ë–∞–ª–∞–Ω—Å —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (30% –ª–∞–π—Ñ, 30% —ç–∫—Å–ø–µ—Ä—Ç–Ω—ã–π, 40% –ø—Ä–æ–¥–∞—é—â–∏–π)
- üîÑ –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ–≤–æ–≤ –∏ –≤–æ—Ä–æ–Ω–æ–∫ –ø—Ä–æ–¥–∞–∂
- üìù –ù–∞–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥–∞—é—â–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤
- üì∏ –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤–∏–∑—É–∞–ª–∞
- üì± –†–∞–±–æ—Ç–∞ —Å–æ —Å—Ç—Ä–∞—Ö–∞–º–∏ –∏ –±–æ–ª—è–º–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤
- üåü –°–æ–∑–¥–∞–Ω–∏–µ –ª–∏—á–Ω–æ–≥–æ –±—Ä–µ–Ω–¥–∞ —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–µ–Ω—Ç

### 3. Reels –∏ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤
- üé¨ –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—É—Å–Ω—ã—Ö Reels —Å –ø—Ä–æ–¥–∞—é—â–∏–º–∏ –≤–æ—Ä–æ–Ω–∫–∞–º–∏
- üìä –ê–Ω–∞–ª–∏–∑ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤
- üîç –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç—Ä–µ–Ω–¥–æ–≤ –∏ –∞–¥–∞–ø—Ç–∞—Ü–∏—è –∏—Ö –ø–æ–¥ –±—å—é—Ç–∏-–Ω–∏—à—É
- üì± –°—ä–µ–º–∫–∞ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤–∏–¥–µ–æ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω
- üí¨ –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Ä–æ–ª–∏–∫–æ–≤
- üéØ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–∞—Ä–≥–µ—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ä–µ–∫–ª–∞–º—ã
- ü§ù –†–∞–±–æ—Ç–∞ —Å –±–ª–æ–≥–µ—Ä–∞–º–∏ –∏ –ª–∏–¥–µ—Ä–∞–º–∏ –º–Ω–µ–Ω–∏–π

### 4. –ü—Ä–æ–¥–∞–∂–∏ –∏ —Ä–∞–±–æ—Ç–∞ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏
- üí∞ –¶–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ –±—å—é—Ç–∏-—Å—Ñ–µ—Ä–µ
- üìû –†–∞–±–æ—Ç–∞ —Å –≤–æ–∑—Ä–∞–∂–µ–Ω–∏—è–º–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤
- üì± –°–æ–∑–¥–∞–Ω–∏–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—Å—ã–ª–æ–∫
- üõçÔ∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –∏ –∞–∫—Ü–∏–π
- ü§ù –ü–æ–≤—ã—à–µ–Ω–∏–µ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤
- üìä –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –∫–ª–∏–µ–Ω—Ç–æ–≤
- üîÑ –ü–æ–≤—ã—à–µ–Ω–∏–µ —Å—Ä–µ–¥–Ω–µ–≥–æ —á–µ–∫–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ—Å—Ç–∏

### 5. –†–∞–∑–≤–∏—Ç–∏–µ –±–∏–∑–Ω–µ—Å–∞
- üìà –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç –º–∞—Å—Ç–µ—Ä–∞ –∫ —Å—Ç—É–¥–∏–∏
- üß† –ü—Ä–æ—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –º—ã—à–ª–µ–Ω–∏—è
- ‚è∞ –¢–∞–π–º-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç –¥–ª—è –±—å—é—Ç–∏-–º–∞—Å—Ç–µ—Ä–∞
- üí∏ –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- üë• –ù–∞–±–æ—Ä –∫–æ–º–∞–Ω–¥—ã –∏ –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- üéì –ü–µ—Ä–µ—Ö–æ–¥ –æ—Ç —É—Å–ª—É–≥ –∫ –æ–±—É—á–µ–Ω–∏—é
- üåê –°–æ–∑–¥–∞–Ω–∏–µ –æ–Ω–ª–∞–π–Ω-–∫—É—Ä—Å–æ–≤ –∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è –±—å—é—Ç–∏-–º–∞—Å—Ç–µ—Ä–æ–≤

### 1. –†–∞—Å–∫—Ä—ã—Ç–∏–µ —Å–µ–±—è –∫–∞–∫ –ª–∏—á–Ω–æ—Å—Ç–∏ (20-25%)
- –•–æ–±–±–∏ –∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã
- –£—Ç—Ä–µ–Ω–Ω–∏–µ —Ä–∏—Ç—É–∞–ª—ã
- "–î–µ–Ω—å —Å–æ –º–Ω–æ–π"
- –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞
- –õ—é–±–∏–º—ã–µ –∫–Ω–∏–≥–∏/—Ñ–∏–ª—å–º—ã
- –†–µ—Ü–µ–ø—Ç—ã –∏ –¥—Ä—É–≥–∏–µ –ª–∏—á–Ω—ã–µ —Ç–µ–º—ã
- –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è –∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –º–µ—Å—Ç–∞

### 2. –†–∞—Å–∫—Ä—ã—Ç–∏–µ —Å–µ–±—è –∫–∞–∫ —ç–∫—Å–ø–µ—Ä—Ç–∞ (50%)
- –ò—Å—Ç–æ—Ä–∏—è –≤—ã–±–æ—Ä–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏
- –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ä–æ—Å—Ç
- –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –∏ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞
- –í–∏–¥–µ–æ-–∏–Ω—Ç–µ—Ä–≤—å—é —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏
- –û–±—É—á–µ–Ω–∏—è –∏ –ø–æ–≤—ã—à–µ–Ω–∏–µ –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –ü–æ–ª–µ–∑–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ –Ω–∏—à–µ
- –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã –∏ –∑–∞–∫—É–ª–∏—Å—å–µ
- –¢—Ä–µ–Ω–¥—ã –∏ –Ω–æ–≤–∏–Ω–∫–∏ –∏–Ω–¥—É—Å—Ç—Ä–∏–∏
- –†–∞–∑–±–æ—Ä –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –º–∏—Ñ–æ–≤

### 3. –ü—Ä–æ–¥–∞—é—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç (20-25%)
- –ò—Å—Ç–æ—Ä–∏–∏ —É—Å–ø–µ—à–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π –ø—Ä–æ–±–ª–µ–º –∫–ª–∏–µ–Ω—Ç–æ–≤
- –ù–∞–≥–ª—è–¥–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞–±–æ—Ç—ã "–¥–æ/–ø–æ—Å–ª–µ"
- –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
- –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —É—Å–ª—É–≥ –∏ –ø—Ä–æ—Ü–µ–¥—É—Ä
- –û—Ç–≤–µ—Ç—ã –Ω–∞ —á–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∫–ª–∏–µ–Ω—Ç–æ–≤
- –≠–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∏ –¥–µ–Ω–µ–≥ —Å –≤–∞—à–µ–π —É—Å–ª—É–≥–æ–π
- –û–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è
- –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –≤ —Ä–∞–±–æ—Ç–µ

## –°—Ç—Ä–∞—Ç–µ–≥–∏—è –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è –¥–ª—è –±—å—é—Ç–∏-–º–∞—Å—Ç–µ—Ä–æ–≤

### 1. –¢—Ä–µ—Ö–∫–∏—Ç–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —É—Å–ø–µ—Ö–∞:
- **–¢—Ä–∞—Ñ–∏–∫** - —Ä–µ–≥—É–ª—è—Ä–Ω—ã–π –ø–æ—Ç–æ–∫ –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
- **–ö–æ–Ω—Ç–µ–Ω—Ç** - –ø—Ä–æ–¥–∞—é—â–∞—è —É–ø–∞–∫–æ–≤–∫–∞ –∏ —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –ø—Ä–æ–≥—Ä–µ–≤—ã
- **–°–µ—Ä–≤–∏—Å** - –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —É—Å–ª—É–≥ –∏ —Ä–∞–±–æ—Ç–∞ –Ω–∞–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ—Å—Ç—å—é

### 2. –û—Å–Ω–æ–≤–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ç—Ä–∞—Ñ–∏–∫–∞:
- **Reels** - —Å–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—É—Å–Ω—ã—Ö —Ä–æ–ª–∏–∫–æ–≤ —Å –≤–æ—Ä–æ–Ω–∫–∞–º–∏ –ø—Ä–æ–¥–∞–∂
- **–†–µ–∫–ª–∞–º–∞ —É –±–ª–æ–≥–µ—Ä–æ–≤** - —Ä–∞–±–æ—Ç–∞ —Å –ª–∏–¥–µ—Ä–∞–º–∏ –º–Ω–µ–Ω–∏–π
- **–ö–æ–Ω–∫—É—Ä—Å–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∫–∏** - —Å–æ–≤–º–µ—Å—Ç–Ω—ã–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Å –¥—Ä—É–≥–∏–º–∏ –º–∞—Å—Ç–µ—Ä–∞–º–∏
- **–†–∞—Å—Å—ã–ª–∫–∏** - —Ä–∞–±–æ—Ç–∞ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –±–∞–∑–æ–π –∫–ª–∏–µ–Ω—Ç–æ–≤
- **–í–∑–∞–∏–º–Ω—ã–π –ø–∏–∞—Ä** - —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ —Å –∫–æ–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ä–Ω—ã–º–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º–∏
- **–°–∞—Ä–∞—Ñ–∞–Ω–Ω–æ–µ —Ä–∞–¥–∏–æ** - –ø—Ä–æ–≥—Ä–∞–º–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ –∏ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã

### 3. –ü—É—Ç—å –∫ –¥–æ—Ö–æ–¥—É 100,000—Ä+:
- –£–ø–∞–∫–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –∏ —Å–æ–∑–¥–∞—Ç—å –ø—Ä–æ–¥–∞—é—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç
- –ü—Ä–∏–≤–ª–µ—á—å –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ç—Ä–∞—Ñ–∏–∫–∞
- –ü–æ—Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ—Å—Ç—å—é –∏ —Å–µ—Ä–≤–∏—Å–æ–º
- –í–Ω–µ–¥—Ä–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –ø–æ–≤—ã—à–µ–Ω–∏—è —Å—Ä–µ–¥–Ω–µ–≥–æ —á–µ–∫–∞
- –ù–∞–ª–∞–¥–∏—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç-–ø–ª–∞–Ω –∏ –ø—Ä–æ–≥—Ä–µ–≤—ã
- –ü—Ä–∏–º–µ–Ω—è—Ç—å —Ç—Ä–µ–Ω–¥–æ–≤—ã–µ —Ñ–∏—à–∫–∏ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç–µ–π
- –ü–æ—Å—Ç–æ—è–Ω–Ω–æ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏ —É–ª—É—á—à–∞—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é

## –ú–∏—Ä–æ–≤–æ–∑–∑—Ä–µ–Ω–∏–µ –¥–ª—è –¥—Ä—É–≥–∏—Ö –Ω–∏—à (–∫—Ä–æ–º–µ –±—å—é—Ç–∏)

### –î–ª—è —Ñ–∏—Ç–Ω–µ—Å-—Ç—Ä–µ–Ω–µ—Ä–æ–≤:
- üí™ "–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è —Ç–µ–ª–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –º—ã—à–ª–µ–Ω–∏—è"
- üî• "–†–µ–∑—É–ª—å—Ç–∞—Ç –∫–ª–∏–µ–Ω—Ç–∞ - –ª—É—á—à–∞—è —Ä–µ–∫–ª–∞–º–∞ –¥–ª—è —Ç—Ä–µ–Ω–µ—Ä–∞"
- üì± "–ö–æ–Ω—Ç–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –º–æ—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å, –æ–±—É—á–∞—Ç—å –∏ –ø—Ä–æ–¥–∞–≤–∞—Ç—å"
- üçé "–ó–¥–æ—Ä–æ–≤—å–µ - —ç—Ç–æ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è, –∞ –Ω–µ —Ä–∞—Å—Ö–æ–¥"
- üß† "–°–∏—Å—Ç–µ–º–Ω–æ—Å—Ç—å –≤ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö = —Å–∏—Å—Ç–µ–º–Ω–æ—Å—Ç—å –≤ –±–∏–∑–Ω–µ—Å–µ"

### –î–ª—è –∫–æ—É—á–µ–π –∏ –ø—Å–∏—Ö–æ–ª–æ–≥–æ–≤:
- üå± "–ü–æ–º–æ–≥–∞—è –¥—Ä—É–≥–∏–º —Ä–∞—Å—Ç–∏, —Ä–∞—Å—Ç–µ—à—å —Å–∞–º"
- üß† "–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–∞—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞ —Å—Ç–æ–∏—Ç –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≥–æ–Ω–æ—Ä–∞—Ä–æ–≤"
- üí¨ "–≠–∫—Å–ø–µ—Ä—Ç–∏–∑–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤–∏–¥–Ω–∞ –µ—â–µ –¥–æ –ø–µ—Ä–≤–æ–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏"
- üåü "–õ–∏—á–Ω—ã–π –±—Ä–µ–Ω–¥ –ø—Å–∏—Ö–æ–ª–æ–≥–∞ - –∫–ª—é—á –∫ –¥–æ–≤–µ—Ä–∏—é –∫–ª–∏–µ–Ω—Ç–æ–≤"
- üì± "–ö–æ–Ω—Ç–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≥–ª—É–±–∏–Ω—É, –Ω–æ –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –¥–æ—Å—Ç—É–ø–Ω—ã–º"

### –î–ª—è –∏–Ω—Ñ–æ–±–∏–∑–Ω–µ—Å–∞:
- üìö "–ó–Ω–∞–Ω–∏—è –∏–º–µ—é—Ç —Ü–µ–Ω–Ω–æ—Å—Ç—å, —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è"
- üí∞ "–ß–µ–º —Ü–µ–Ω–Ω–µ–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É—á–µ–Ω–∏–∫–∞, —Ç–µ–º –≤—ã—à–µ –º–æ–∂–Ω–æ —Å—Ç–∞–≤–∏—Ç—å —Ü–µ–Ω—É"
- üöÄ "–û—Ç —ç–∫—Å–ø–µ—Ä—Ç–∞ –∫ –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫—É - –ø—É—Ç—å –∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é"
- üì± "Reels - –≤–∏—Ç—Ä–∏–Ω–∞ –¥–ª—è —Ç–≤–æ–µ–π —ç–∫—Å–ø–µ—Ä—Ç–Ω–æ—Å—Ç–∏"
- üîÑ "–ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –ø–æ–¥ –∑–∞–ø—Ä–æ—Å—ã —Ä—ã–Ω–∫–∞"

### –î–ª—è –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–æ–≤:
- üõçÔ∏è "–ü—Ä–æ–¥–∞–∂–∏ —á–µ—Ä–µ–∑ —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏ - —ç—Ç–æ –æ–±—â–µ–Ω–∏–µ, –∞ –Ω–µ –∫–∞—Ç–∞–ª–æ–≥"
- üß∞ "–ü–æ–∫–∞–∑—ã–≤–∞–π –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞, –∞ –Ω–µ —Å–∞–º —Ç–æ–≤–∞—Ä"
- üì± "–ö–æ–Ω—Ç–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω —Ä–µ—à–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –∫–ª–∏–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ —Ç–≤–æ–π –ø—Ä–æ–¥—É–∫—Ç"
- üîç "–ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∞–∂–Ω–µ–µ, —á–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤"
- ü§ù "–°–µ—Ä–≤–∏—Å –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏ —Å–æ–∑–¥–∞—é—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤"

## –í–æ–∑–º–æ–∂–Ω—ã–µ –≤–æ–∑—Ä–∞–∂–µ–Ω–∏—è –∏ –∏—Ö –æ—Ç—Ä–∞–±–æ—Ç–∫–∞

### "–£ –º–µ–Ω—è –º–∞–ª–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤, —ç—Ç–æ –±–µ—Å–ø–æ–ª–µ–∑–Ω–æ"
- üî• "–ö–∞—á–µ—Å—Ç–≤–æ –∞—É–¥–∏—Ç–æ—Ä–∏–∏ –≤–∞–∂–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞"
- üëë "–õ—É—á—à–µ 100 —Ü–µ–ª–µ–≤—ã—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤, —á–µ–º 10,000 —Å–ª—É—á–∞–π–Ω—ã—Ö"
- üìà "–í—Å–µ —Å —á–µ–≥–æ-—Ç–æ –Ω–∞—á–∏–Ω–∞–ª–∏, —Ä–æ—Å—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ —Å–∏—Å—Ç–µ–º–Ω–æ–π —Ä–∞–±–æ—Ç–µ"

### "–í –º–æ–µ–º –≥–æ—Ä–æ–¥–µ/–Ω–∏—à–µ –º–Ω–æ–≥–æ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤"
- üíé "–ö–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –Ω–∏—à–∞ –ø—Ä–∏–±—ã–ª—å–Ω–∞—è"
- üåü "–õ–∏—á–Ω—ã–π –±—Ä–µ–Ω–¥ –∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –Ω–µ –∏–º–µ—é—Ç –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏"
- üöÄ "–ù–µ –∫–æ–Ω–∫—É—Ä–∏—Ä—É–π —Ü–µ–Ω–æ–π, –∫–æ–Ω–∫—É—Ä–∏—Ä—É–π —Ü–µ–Ω–Ω–æ—Å—Ç—å—é"

### "–£ –º–µ–Ω—è –Ω–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –∫–æ–Ω—Ç–µ–Ω—Ç"
- ‚è∞ "20 –º–∏–Ω—É—Ç –≤ –¥–µ–Ω—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏"
- üì± "–û–¥–∏–Ω –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π Reels –≤ –Ω–µ–¥–µ–ª—é —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –ø—É—Å—Ç–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞"
- üîÑ "–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–∏—Å—Ç–µ–º–Ω–æ—Å—Ç—å —ç–∫–æ–Ω–æ–º—è—Ç –≤—Ä–µ–º—è"

### "–Ø –Ω–µ —É–º–µ—é —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç"
- üå± "–≠—Ç–æ–º—É –º–æ–∂–Ω–æ –Ω–∞—É—á–∏—Ç—å—Å—è, –∫–∞–∫ –∏ –ª—é–±–æ–º—É –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–º—É –Ω–∞–≤—ã–∫—É"
- üìù "–ù–∞—á–Ω–∏ —Å –ø—Ä–æ—Å—Ç—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ –∏ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —É—Å–ª–æ–∂–Ω—è–π"
- üåü "–¢–≤–æ—è —ç–∫—Å–ø–µ—Ä—Ç–Ω–æ—Å—Ç—å –≤–∞–∂–Ω–µ–µ —Ç–≤–æ–∏—Ö –Ω–∞–≤—ã–∫–æ–≤ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞"

## –ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Å–æ–≤–µ—Ç–æ–≤

### –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–¥–∞—é—â–µ–≥–æ Reels:
1. üé¨ –¶–µ–ø–ª—è—é—â–µ–µ –Ω–∞—á–∞–ª–æ (–ø–µ—Ä–≤—ã–µ 1-3 —Å–µ–∫—É–Ω–¥—ã)
2. üîç –§–æ–∫—É—Å –Ω–∞ –ø—Ä–æ–±–ª–µ–º–µ/–±–æ–ª–∏ —Ü–µ–ª–µ–≤–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏
3. üí° –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è —á–µ—Ä–µ–∑ —Ç–≤–æ—é —É—Å–ª—É–≥—É
4. üìä –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ "–¥–æ/–ø–æ—Å–ª–µ"
5. üöÄ –ü—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º
6. üéµ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç—Ä–µ–Ω–¥–æ–≤–æ–π –º—É–∑—ã–∫–∏
7. üì± –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–≤–µ—Ç –∏ –∫–∞—Ä—Ç–∏–Ω–∫–∞

### –†–∞–±–æ—Ç–∞ —Å —Ä–∞—Å—Å—ã–ª–∫–∞–º–∏:
1. üì± –†–µ–≥—É–ª—è—Ä–Ω—ã–µ —Ä–∞—Å—Å—ã–ª–∫–∏ –ø–æ –±–∞–∑–µ –∫–ª–∏–µ–Ω—Ç–æ–≤
2. üîç –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –∏ –æ–±—Ä–∞—â–µ–Ω–∏–µ –ø–æ –∏–º–µ–Ω–∏
3. üí° –¶–µ–Ω–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –∏–ª–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –∞–∫—Ü–∏—è
4. ‚è∞ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏—è
5. üìä –ü–æ–Ω—è—Ç–Ω—ã–µ –≤—ã–≥–æ–¥—ã –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
6. üöÄ –ß–µ—Ç–∫–∏–π –ø—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é
7. üîÑ –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

### –ü–æ–≤—ã—à–µ–Ω–∏–µ —Å—Ä–µ–¥–Ω–µ–≥–æ —á–µ–∫–∞:
1. üì¶ –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
2. üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏/–ø—Ä–æ–¥—É–∫—Ç—ã
3. üí° –ü—Ä–æ–≥—Ä–∞–º–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ –∏ –∞–±–æ–Ω–µ–º–µ–Ω—Ç—ã
4. ‚è∞ –ü–æ–≤—ã—à–µ–Ω–∏–µ —Ü–µ–Ω–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–∏—Å
5. üìä –ß–µ—Ç–∫–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è
6. üöÄ –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
7. üîÑ –†–µ–≥—É–ª—è—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ —Ü–µ–Ω

## –ó–∞–≤–µ—Ä—à–∞—é—â–∏–µ –º—ã—Å–ª–∏

üíé **–ë–∏–∑–Ω–µ—Å –≤ –±—å—é—Ç–∏-—Å—Ñ–µ—Ä–µ ‚Äî —ç—Ç–æ —Å–∏—Å—Ç–µ–º–∞, –∞ –Ω–µ —É–¥–∞—á–∞**
üî• **–ö–æ–Ω—Ç–µ–Ω—Ç ‚Äî –º–æ—Å—Ç –º–µ–∂–¥—É —Ç–æ–±–æ–π –∏ –∫–ª–∏–µ–Ω—Ç–æ–º**
üì± **Reels ‚Äî —Å–∞–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤**
üëë **–õ–∏—á–Ω—ã–π –±—Ä–µ–Ω–¥ ‚Äî —Ç–æ, —á—Ç–æ –Ω–µ–ª—å–∑—è —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å**
üí∞ **–¶–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ ‚Äî –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ —Ç–≤–æ–µ–π —Ü–µ–Ω–Ω–æ—Å—Ç–∏ –∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏**
üöÄ **–î–µ–π—Å—Ç–≤–∏–µ –≤–∞–∂–Ω–µ–µ –ø–µ—Ä—Ñ–µ–∫—Ü–∏–æ–Ω–∏–∑–º–∞**
üí´ **–° –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π –∏ —Å–∏—Å—Ç–µ–º–æ–π –∫–∞–∂–¥—ã–π –º–æ–∂–µ—Ç –¥–æ–±–∏—Ç—å—Å—è —É—Å–ø–µ—Ö–∞!**"""

            # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ —Å –ø–æ–≤—Ç–æ—Ä–∞–º–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ
            max_retries = 3
            retry_count = 0

            while retry_count < max_retries:
                try:
                    # Generate response with extended context
                    completion = client.chat.completions.create(
                        model="gpt-4",
                        messages=[
                            {"role": "system", "content": system_prompt},
                            {"role": "user", "content": message.text}
                        ]
                    )
                    text = completion.choices[0].message.content
                    break  # –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–µ–Ω, –≤—ã—Ö–æ–¥–∏–º –∏–∑ —Ü–∏–∫–ª–∞
                except Exception as e:
                    retry_count += 1
                    if retry_count >= max_retries:
                        raise  # –ï—Å–ª–∏ –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –∏—Å—á–µ—Ä–ø–∞–Ω—ã, –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –≤—ã—à–µ
                    logger.warning(f"API error, retrying ({retry_count}/{max_retries}): {e}")
                    await asyncio.sleep(1)  # –ü–∞—É–∑–∞ –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–µ–π –ø–æ–ø—ã—Ç–∫–æ–π

        # –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–¥–∞—á—É –∞–Ω–∏–º–∞—Ü–∏–∏ –∏ —É–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ "thinking"
        if 'animation_task' in locals() and animation_task is not None:
            animation_task.cancel()
        await bot.delete_message(chat_id=thinking_message.chat.id, message_id=thinking_message.message_id)

        # Send the response
        await message.answer(text, parse_mode="Markdown")

        # Log the conversation
        log_conversation(user.id, message.text, text)

        # Increase question counter for non-VIP users
        if not is_vip:
            user_questions[user.id] += 1
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ–±—ã —Å—á–µ—Ç—á–∏–∫ –Ω–µ –ø—Ä–µ–≤—ã—Å–∏–ª MAX_QUESTIONS
            if user_questions[user.id] > MAX_QUESTIONS:
                user_questions[user.id] = MAX_QUESTIONS
            save_user_data()  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ

            # Check if limit is reached after this question
            if user_questions[user.id] >= MAX_QUESTIONS:
                await message.answer(
                    f"–Ø —Ö–æ—Ç—å –∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –î–∏–∞–Ω–∞, –Ω–æ —Ç–æ–∂–µ –º–æ–≥—É —É—Å—Ç–∞—Ç—å üò¥\n\n"
                    "–ù–µ–π—Ä–æ—Å–µ—Ç–∏ –ø–æ–ª–µ–∑–Ω—ã, –Ω–æ <b>–¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–µ–Ω–µ–≥ –≤ –±—å—é—Ç–∏-—Å—Ñ–µ—Ä–µ –Ω—É–∂–Ω–∞ –ø—Ä–æ–¥—É–º–∞–Ω–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è!</b> "
                    "–ü—Ä–µ–¥–ª–∞–≥–∞—é –ø–µ—Ä–µ—Å—Ç–∞—Ç—å —Ç—Ä–∞—Ç–∏—Ç—å –≤—Ä–µ–º—è –≤–ø—É—Å—Ç—É—é –∏ –Ω–∞—á–∞—Ç—å –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –±–æ–ª—å—à–µ —É–∂–µ —á–µ—Ä–µ–∑ –º–µ—Å—è—Üüí∏\n\n"
                    "–î–∏–∞–Ω–∞, –æ–ø–∏—Ä–∞—è—Å—å –Ω–∞ —Å–≤–æ–π –æ–ø—ã—Ç, —Å–æ–∑–¥–∞–ª–∞ –∫—É—Ä—Å ¬´–ë—å—é—Ç–∏-reels¬ª, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –ª—é–±–æ–π –º–∞—Å—Ç–µ—Ä —Å–º–æ–∂–µ—Ç "
                    "–ø—Ä–∏–≤–ª–µ—á—å –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ –∑–∞–±–∏—Ç—å –∑–∞–ø–∏—Å—å!\n\n"
                    f"–•–æ—á–µ—à—å –∑–Ω–∞—Ç—å –ª—é–±–æ–π –æ—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å –∏ –±–µ–∑ –Ω–µ–π—Ä–æ—Å–µ—Ç–µ–π? <b>–ó–∞–ø–æ–ª–Ω—è–π –∞–Ω–∫–µ—Ç—É –ø—Ä–µ–¥–∑–∞–ø–∏—Å–∏</b>üëâ {REGISTRATION_URL}",
                    reply_markup=get_limit_reached_keyboard(),
                    parse_mode="HTML"
                )
    except Exception as e:
        # –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–¥–∞—á—É –∞–Ω–∏–º–∞—Ü–∏–∏ –∏ —É–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ "thinking"
        if 'animation_task' in locals() and animation_task is not None:
            animation_task.cancel()
        await bot.delete_message(chat_id=thinking_message.chat.id, message_id=thinking_message.message_id)

        # Send error message
        logger.error(f"Error processing message: {e}")
        await message.answer(
            f"–ò–∑–≤–∏–Ω–∏, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç–≤–æ–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Å—å –∫ –î–∏–∞–Ω–µ —á–µ—Ä–µ–∑ –∞–Ω–∫–µ—Ç—É –ø—Ä–µ–¥–∑–∞–ø–∏—Å–∏ –Ω–∞ –∫—É—Ä—Å: {REGISTRATION_URL}",
            reply_markup=get_limit_reached_keyboard(),
            parse_mode="HTML"
        )


# HANDLER FOR ANY TEXT MESSAGE
@dp.message(lambda message: message.text)
async def filter_messages(message: Message):
    user = message.from_user

    # Initialize question counter if not exists
    if user.id not in user_questions:
        user_questions[user.id] = 0
        save_user_data()

        registered_users.add(user.id)  # –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å–ø–∏—Å–æ–∫ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
        save_registered_users()

    # Check if user is VIP
    is_vip = user.id in VIP_USERS

    # Check question limit for non-VIP users
    if not is_vip and user_questions[user.id] >= MAX_QUESTIONS:
        await message.answer(
            f"{user.first_name}, –ª–∏–º–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –∑–∞–∫–æ–Ω—á–∏–ª—Å—è, –Ω–æ —è –∑–Ω–∞—é –∫–∞–∫ —Ç–µ–±–µ –ø–æ–º–æ—á—å! "
            "–ù–∞ –∫—É—Ä—Å–µ ¬´–ë—å—é—Ç–∏-reels¬ª —Ç—ã –Ω–∞–π–¥–µ—à—å –æ—Ç–≤–µ—Ç –Ω–∞ –ª—é–±–æ–π –≤–æ–ø—Ä–æ—Å! "
            f"<b>–ó–∞–ø–æ–ª–Ω—è–π –∞–Ω–∫–µ—Ç—É –ø—Ä–µ–¥–∑–∞–ø–∏—Å–∏</b>üëâ {REGISTRATION_URL}",
            reply_markup=get_limit_reached_keyboard(),
            parse_mode="HTML"
        )
        return

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º –æ –Ω–æ–≤–æ–º –≤–æ–ø—Ä–æ—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    current_question_count = user_questions[user.id] + 1  # +1 –ø–æ—Ç–æ–º—É —á—Ç–æ —Ç–µ–∫—É—â–∏–π –≤–æ–ø—Ä–æ—Å –µ—â–µ –Ω–µ —É—á—Ç–µ–Ω –≤ —Å—á–µ—Ç—á–∏–∫–µ
    # –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ–±—ã —Å—á–µ—Ç—á–∏–∫ –Ω–µ –ø—Ä–µ–≤—ã—Å–∏–ª MAX_QUESTIONS –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    if not is_vip and current_question_count > MAX_QUESTIONS:
        current_question_count = MAX_QUESTIONS

    await forward_user_message_to_admins(user, message.text, current_question_count)

    # –°–æ–æ–±—â–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ —Å—Ç–∞—Ç—É—Å–µ –≤ –æ—á–µ—Ä–µ–¥–∏, –µ—Å–ª–∏ –æ—á–µ—Ä–µ–¥—å –Ω–µ –ø—É—Å—Ç–∞
    status_message_id = None
    if len(message_queue) > 0 or processing:
        # –ö—Ä–∞—Å–∏–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Å—Ç–∞—Ç—É—Å–µ –æ—á–µ—Ä–µ–¥–∏
        queue_status = await message.answer(
            f"‚ú® {user.first_name}, —Ç–≤–æ–π –≤–æ–ø—Ä–æ—Å –ø—Ä–∏–Ω—è—Ç! ‚ú®\n\n"
            f"–í –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç —è –∑–∞–Ω—è—Ç–∞ –æ—Ç–≤–µ—Ç–∞–º–∏ –¥—Ä—É–≥–∏–º –±—å—é—Ç–∏-–º–∞—Å—Ç–µ—Ä–∞–º, "
            f"–Ω–æ —Å–∫–æ—Ä–æ –ø—Ä–∏—Å—Ç—É–ø–ª—é –∫ —Ç–≤–æ–µ–º—É –≤–æ–ø—Ä–æ—Å—É.\n\n"
            f"–ö–∞–∫ —Ç–æ–ª—å–∫–æ –æ—Å–≤–æ–±–æ–∂—É—Å—å ‚Äî —Å—Ä–∞–∑—É –æ—Ç–≤–µ—á—É! üíÖüíÑ",
            parse_mode="HTML"
        )
        status_message_id = queue_status.message_id

    # –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –æ—á–µ—Ä–µ–¥—å –æ–±—Ä–∞–±–æ—Ç–∫–∏
    message_queue.append((message, is_vip, status_message_id))

    # –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—á–µ—Ä–µ–¥–∏, –µ—Å–ª–∏ –æ–Ω–∞ –Ω–µ –∑–∞–ø—É—â–µ–Ω–∞
    asyncio.create_task(process_message_queue())


# Scheduled reminder
async def send_reminder():
    """Send reminder to users who haven't filled the form yet"""
    while True:
        try:
            # Wait for 2 hours
            await asyncio.sleep(7200)  # 2 * 60 * 60 seconds

            for user_id in registered_users:
                if user_id not in VIP_USERS and user_id in user_questions and user_questions[user_id] > 0:
                    try:
                        user = await bot.get_chat(user_id)
                        await bot.send_message(
                            user_id,
                            f"{user.first_name}, –∫–∞–∂–µ—Ç—Å—è, <b>–≤—ã —É–ø—É—Å–∫–∞–µ—Ç–µ –∫–æ–µ-—á—Ç–æ –≤–∞–∂–Ω–æ–µ!</b> "
                            "–Ø –Ω–µ –≤–∏–∂—É –≤–∞—Å –≤ –∑–∞–∫—Ä—ã—Ç–æ–º —Ç–≥-–∫–∞–Ω–∞–ª–µ –±—É–¥—É—â–∏—Ö —É—á–µ–Ω–∏—Ü –∫—É—Ä—Å–∞ ¬´–ë—å—é—Ç–∏-reels¬ª! üò±\n\n"
                            f"–ò–º–µ–Ω–Ω–æ —Ç—É–¥–∞ —Ç—ã –ø–æ–ø–∞–¥–µ—à—å –ø–æ—Å–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –∞–Ω–∫–µ—Ç—ãüëâ {REGISTRATION_URL}\n\n"
                            "<b>–í–Ω—É—Ç—Ä–∏ ‚Äì —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã:</b> –ø–æ–ª–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ –∫—É—Ä—Å–∞, —Å–∞–º—ã–µ –≤—ã–≥–æ–¥–Ω—ã–µ —Ü–µ–Ω—ã –Ω–∞ –Ω–æ–≤—ã–π –ø–æ—Ç–æ–∫, "
                            "–ø–æ–ª–µ–∑–Ω—ã–µ –ø–æ–¥–∫–∞—Å—Ç—ã –∏ –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ!\n\n"
                            "–ù–µ —É–ø—É—Å—Ç–∏ —à–∞–Ω—Å –ø–æ–ª—É—á–∏—Ç—å —Ü–µ–Ω–Ω—ã–µ –∑–Ω–∞–Ω–∏—è ‚Äì –∑–∞–ø–æ–ª–Ω–∏ –∞–Ω–∫–µ—Ç—É –∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å!",
                            reply_markup=get_reminder_keyboard(),
                            parse_mode="HTML"
                        )
                    except Exception as e:
                        logger.error(f"Error sending reminder to user {user_id}: {e}")
        except Exception as e:
            logger.error(f"Error in reminder task: {e}")
            await asyncio.sleep(60)  # –ï—Å–ª–∏ –æ—à–∏–±–∫–∞, –∂–¥–µ–º –º–∏–Ω—É—Ç—É –∏ –ø—ã—Ç–∞–µ–º—Å—è —Å–Ω–æ–≤–∞


async def main():
    # –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–æ–≤ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
    load_data()

    try:
        # Start the reminder task
        reminder_task = asyncio.create_task(send_reminder())

        # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–æ–ª—å—à–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –ª–∏–º–∏—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –¥–ª—è aiohttp
        connector = aiohttp.TCPConnector(limit=100)  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 100 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
        session = aiohttp.ClientSession(connector=connector)

        bot._session = session  # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ—Å—Å–∏—é —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–º –ª–∏–º–∏—Ç–æ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

        await bot(DeleteWebhook(drop_pending_updates=True))
        await dp.start_polling(bot)

    except Exception as e:
        logger.error(f"Error in main function: {e}")

    finally:
        # –ó–∞–∫—Ä—ã–≤–∞–µ–º —Å–µ—Å—Å–∏—é –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞
        if 'session' in locals() and session is not None:
            await session.close()


if __name__ == "__main__":
    asyncio.run(main())
